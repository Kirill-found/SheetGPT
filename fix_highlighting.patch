--- ai_code_executor.py.old
+++ ai_code_executor.py
@@ -472,8 +472,14 @@
         else:
             highlighting_data = None
             print(f"❌ No highlight keywords in query")

-        # Старый метод как fallback (закомментирован)
-        # highlighting_data = self._generate_highlighting_if_needed(query, result_dict)
+        # Используем умную функцию для анализа реальных данных
+        # Если простая логика не сработала или не дала правильных строк
+        if not highlighting_data or (highlighting_data and len(highlighting_data.get('highlight_rows', [])) == 0):
+            # Пробуем использовать более умную функцию с анализом данных
+            smart_highlighting = self._generate_highlighting_if_needed(query, result_dict)
+            if smart_highlighting:
+                highlighting_data = smart_highlighting
+                print(f"✅ Using smart highlighting function: {highlighting_data}")
+
         if highlighting_data:
             print(f"✅ Highlighting data generated: {highlighting_data}")