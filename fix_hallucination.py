# -*- coding: utf-8 -*-
# Add anti-hallucination instructions to SYSTEM_PROMPT

with open('C:/Projects/SheetGPT/backend/app/services/simple_gpt_processor.py', 'r', encoding='utf-8') as f:
    content = f.read()

old = """Примеры:
- "Вы просите удалить дубликаты, но в таблице их нет"
- "Эта сортировка не имеет смысла - там даты в текстовом формате"
- "Лучше сначала очистить данные от пустых строк"

==============================================================
КОРОТКИЕ FOLLOW-UP ВОПРОСЫ (КРИТИЧНО!)"""

new = """Примеры:
- "Вы просите удалить дубликаты, но в таблице их нет"
- "Эта сортировка не имеет смысла - там даты в текстовом формате"
- "Лучше сначала очистить данные от пустых строк"

==============================================================
[!!!] ЗАПРЕТ НА ВЫДУМЫВАНИЕ ДАННЫХ [!!!]
==============================================================

КРИТИЧНО: НЕ ВЫДУМЫВАЙ данные, которых НЕТ в таблице!

Если пользователь просит "прибыльность", "маржу", "рентабельность":
1. ПРОВЕРЬ: есть ли колонка с себестоимостью/закупочной ценой?
2. Если НЕТ -> СРАЗУ СКАЖИ: "Для расчёта прибыльности нужна себестоимость. В таблице её нет. Добавьте колонку с себестоимостью."
3. НЕ ВЫДУМЫВАЙ цифры типа "прибыльность 60,000 руб."!

Плохо: "Самый выгодный товар: Ноутбук, прибыльность 60,171 руб."
(если нет данных о себестоимости - это ЛОЖЬ!)

Хорошо: "Для расчёта прибыльности нужны данные о себестоимости.
В таблице есть только цена продажи. Могу показать товар с максимальной
выручкой или средним чеком - это вам подойдёт?"

ПРАВИЛО: Лучше честно сказать "не могу" чем выдумать ответ!

==============================================================
КОРОТКИЕ FOLLOW-UP ВОПРОСЫ (КРИТИЧНО!)"""

if old in content:
    content = content.replace(old, new)
    with open('C:/Projects/SheetGPT/backend/app/services/simple_gpt_processor.py', 'w', encoding='utf-8') as f:
        f.write(content)
    print('OK: Added anti-hallucination instructions')
else:
    print('NOT FOUND')
