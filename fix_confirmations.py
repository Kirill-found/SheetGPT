# -*- coding: utf-8 -*-
# Add handling for confirmation words like "давай", "да", "ок"

with open('C:/Projects/SheetGPT/backend/app/services/simple_gpt_processor.py', 'r', encoding='utf-8') as f:
    content = f.read()

old = """==============================================================
КОРОТКИЕ FOLLOW-UP ВОПРОСЫ (КРИТИЧНО!)
==============================================================

Если запрос короткий (1-3 слова) типа:
- "а на Ozon?" / "а WB?" / "а по МСК?"
- "а Петров?" / "а за июль?" / "а вчера?"
- "а сколько?" / "а какой процент?"

-> ЭТО ПРОДОЛЖЕНИЕ предыдущего вопроса!
-> Посмотри в ИСТОРИЮ ДИАЛОГА выше
-> Примени ТУ ЖЕ ЛОГИКУ, просто с другим параметром

Пример:
- История: "Сколько товаров на WB?" -> "31912 шт"
- Запрос: "а на Ozon?"
- Понимание: "Сколько товаров на Ozon?"
- Ответ: chat с количеством товаров на Ozon (НЕ highlight!)"""

new = """==============================================================
КОРОТКИЕ FOLLOW-UP ВОПРОСЫ И ПОДТВЕРЖДЕНИЯ (КРИТИЧНО!)
==============================================================

1) ПОДТВЕРЖДЕНИЯ - если запрос это одно слово-согласие:
   "давай", "да", "ок", "хорошо", "согласен", "покажи", "сделай", "го"

   -> Посмотри свой ПРЕДЫДУЩИЙ ОТВЕТ в истории
   -> Если ты предложил альтернативу - ВЫПОЛНИ её!

   Пример:
   - Твой ответ: "Могу показать товар с максимальной выручкой. Подходит?"
   - Запрос: "давай"
   - Действие: ПОКАЖИ товар с максимальной выручкой (НЕ переспрашивай!)

2) ПРОДОЛЖЕНИЯ - если запрос (1-3 слова) типа:
   "а на Ozon?" / "а WB?" / "а по МСК?"
   "а Петров?" / "а за июль?" / "а вчера?"
   "а сколько?" / "а какой процент?"

   -> ЭТО ПРОДОЛЖЕНИЕ предыдущего вопроса!
   -> Посмотри в ИСТОРИЮ ДИАЛОГА выше
   -> Примени ТУ ЖЕ ЛОГИКУ, просто с другим параметром

   Пример:
   - История: "Сколько товаров на WB?" -> "31912 шт"
   - Запрос: "а на Ozon?"
   - Понимание: "Сколько товаров на Ozon?"
   - Ответ: chat с количеством товаров на Ozon (НЕ highlight!)"""

if old in content:
    content = content.replace(old, new)
    with open('C:/Projects/SheetGPT/backend/app/services/simple_gpt_processor.py', 'w', encoding='utf-8') as f:
        f.write(content)
    print('OK: Added confirmation handling instructions')
else:
    print('NOT FOUND')
