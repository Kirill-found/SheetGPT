# ИНСТРУКЦИЯ ПО УСТАНОВКЕ ФИНАЛЬНОЙ ВЕРСИИ SheetGPT

## ПРОБЛЕМА БЫЛА В:
- DEBUG версия отправляла только 10 строк данных
- Если Товар 14 встречался после 10-й строки, эти данные не попадали на сервер
- Поэтому вместо 6 строк обрабатывалось только 3

## РЕШЕНИЕ:
- Финальная версия отправляет ВСЕ строки (до 1000)
- Правильно агрегирует все дубликаты
- Товар 14 теперь правильно показывает сумму 588,530

## УСТАНОВКА:

### ШАГ 1: Откройте Google Sheets
1. Откройте вашу таблицу с данными
2. Перейдите в меню **Расширения → Apps Script**

### ШАГ 2: Замените Code.gs
1. **УДАЛИТЕ ВСЕ** в текущем Code.gs
2. Скопируйте **ВЕСЬ** код из файла `Code_PRODUCTION_FINAL.gs`
3. Вставьте в редактор Apps Script

### ШАГ 3: Проверьте критические строки
Убедитесь, что в коде есть эти строки (около строки 73-74):
```javascript
// КРИТИЧЕСКИ ВАЖНО: ОТПРАВЛЯЕМ ВСЕ ДАННЫЕ!
dataToSend = values.slice(startRow, Math.min(startRow + 1000, values.length));
```

**НЕ ДОЛЖНО БЫТЬ:**
```javascript
// Это НЕПРАВИЛЬНО - отправляет только 10 строк!
dataToSend = values.slice(0, 10);
```

### ШАГ 4: Сохраните и обновите
1. Нажмите **Ctrl+S** или кнопку **Сохранить**
2. Перезагрузите вашу таблицу Google Sheets
3. В меню появится **SheetGPT → Открыть AI помощник**

### ШАГ 5: ПРОВЕРКА
1. Откройте AI помощник
2. Спросите: **"Топ 3 товара по продажам"**
3. Должен ответить:
   - **Товар 14: 588,529.80 руб.** ✅
   - Товар 2: 411,281.76 руб.
   - Товар 8: 378,191.85 руб.

4. Спросите: **"У какого поставщика больше всего продаж"**
5. Должен ответить:
   - **ООО Время: 695,833 руб.** ✅ (НЕ Радость!)

## ДОПОЛНИТЕЛЬНАЯ ПРОВЕРКА

В Code.gs есть функция `testDataCheck()`:
1. В редакторе Apps Script выберите функцию `testDataCheck`
2. Нажмите **Выполнить**
3. Появится окно с информацией:
   - Сколько всего строк отправляется
   - Какие товары имеют дубликаты
   - Товар 14 должен показать: **6 строк**

## ЕСЛИ ВСЕ ЕЩЕ НЕ РАБОТАЕТ:

1. Проверьте консоль (F12 в браузере)
2. Ищите строку: `Отправляем строк данных: XXX`
   - Должно быть больше 10!
   - Если видите 10 - у вас старая версия

3. Полностью очистите кэш:
   - Ctrl+Shift+R в браузере
   - Закройте все вкладки с Google Sheets
   - Откройте заново

## API СТАТУС:
- Версия: 3.0.6
- URL: https://sheetgpt-production.up.railway.app
- Статус: ✅ Работает и правильно агрегирует данные