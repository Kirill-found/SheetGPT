<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SheetGPT Debug Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .test-section {
      border: 2px solid #0f9d58;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    .result {
      background: #f5f5f5;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .success { background: #c8e6c9; }
    .error { background: #ffcdd2; }
    button {
      background: #0f9d58;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0b8043; }
    h2 { color: #0f9d58; }
  </style>
</head>
<body>
  <h1>üîç SheetGPT Debug Test</h1>

  <div class="test-section">
    <h2>–¢–µ—Å—Ç 1: –° –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (–∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å)</h2>
    <button onclick="testWithHeaders()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
    <div id="result1" class="result">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
  </div>

  <div class="test-section">
    <h2>–¢–µ—Å—Ç 2: –ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–∫–∞–∫ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å)</h2>
    <button onclick="testWithoutHeaders()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
    <div id="result2" class="result">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
  </div>

  <div class="test-section">
    <h2>–¢–µ—Å—Ç 3: –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ –∫–∞–∫ –∏–∑ Google Sheets</h2>
    <button onclick="testGoogleSheetsSimulation()">–≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å Google Sheets</button>
    <div id="result3" class="result">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
  </div>

  <script>
    const API_URL = 'https://sheetgpt-production.up.railway.app/api/v1/formula';

    // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    const testData = [
      ["–¢–æ–≤–∞—Ä 1", "–û–û–û –í—Ä–µ–º—è", 10730.32, 1010, 107303.2],
      ["–¢–æ–≤–∞—Ä 2", "–û–û–û –°–∞—Ç—É—Ä–Ω", 8568.37, 1030, 257051.1],
      ["–¢–æ–≤–∞—Ä 3", "–û–û–û –õ—É–Ω–∞", 7318.09, 1020, 146361.8],
      ["–¢–æ–≤–∞—Ä 14", "–û–û–û –í—Ä–µ–º—è", 6328.28, 1007, 44297.96],
      ["–¢–æ–≤–∞—Ä 5", "–û–û–û –ü–µ—Ä—Å–µ–∫—Ç–∏–≤", 1196.9, 1017, 20347.3],
      ["–¢–æ–≤–∞—Ä 14", "–û–û–û –í—Ä–µ–º—è", 6328.28, 1023, 145550.44],
      ["–¢–æ–≤–∞—Ä 7", "–û–û–û –ö–æ—Å–º–æ—Å", 2499.28, 1012, 29991.36],
      ["–¢–æ–≤–∞—Ä 8", "–û–û–û –†–∞–¥–æ—Å—Ç—å", 25212.79, 1015, 378191.85],
      ["–¢–æ–≤–∞—Ä 14", "–û–û–û –í—Ä–µ–º—è", 6328.28, 1023, 145550.44],
      ["–¢–æ–≤–∞—Ä 10", "–ò–ü –†–∞–∑—É–º", 17789.22, 1010, 177892.2]
    ];

    async function testWithHeaders() {
      const resultDiv = document.getElementById('result1');
      resultDiv.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å...';

      const payload = {
        query: "—É –∫–∞–∫–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂",
        column_names: ["–¢–æ–≤–∞—Ä", "–ü–æ—Å—Ç–∞–≤—â–∏–∫", "–¶–µ–Ω–∞", "–û–±—ä–µ–º", "–ü—Ä–æ–¥–∞–∂–∏"],
        sheet_data: testData,
        history: []
      };

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        resultDiv.className = 'result success';
        resultDiv.textContent = `‚úÖ –û–¢–í–ï–¢ –° –ó–ê–ì–û–õ–û–í–ö–ê–ú–ò:
–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.summary || '–ù–ï–¢'}
–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è: ${result.methodology || '–ù–ï–¢'}
–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:
${result.key_findings ? result.key_findings.join('\n') : '–ù–ï–¢'}

–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:
${JSON.stringify(result, null, 2)}`;
      } catch(error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
      }
    }

    async function testWithoutHeaders() {
      const resultDiv = document.getElementById('result2');
      resultDiv.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å...';

      const payload = {
        query: "—É –∫–∞–∫–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂",
        column_names: ["–ö–æ–ª–æ–Ω–∫–∞ A", "–ö–æ–ª–æ–Ω–∫–∞ B", "–ö–æ–ª–æ–Ω–∫–∞ C", "–ö–æ–ª–æ–Ω–∫–∞ D", "–ö–æ–ª–æ–Ω–∫–∞ E"],
        sheet_data: testData,
        history: []
      };

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        resultDiv.className = 'result success';
        resultDiv.textContent = `‚úÖ –û–¢–í–ï–¢ –ë–ï–ó –ó–ê–ì–û–õ–û–í–ö–û–í:
–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.summary || '–ù–ï–¢'}
–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è: ${result.methodology || '–ù–ï–¢'}
–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:
${result.key_findings ? result.key_findings.join('\n') : '–ù–ï–¢'}

–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:
${JSON.stringify(result, null, 2)}`;
      } catch(error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
      }
    }

    async function testGoogleSheetsSimulation() {
      const resultDiv = document.getElementById('result3');
      resultDiv.textContent = '–≠–º—É–ª–∏—Ä—É—é Google Sheets...';

      // –≠–º—É–ª–∏—Ä—É–µ–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Code.gs
      const sheetData = {
        data: [
          ["–¢–æ–≤–∞—Ä", "–ü–æ—Å—Ç–∞–≤—â–∏–∫", "–¶–µ–Ω–∞", "–û–±—ä–µ–º", "–ü—Ä–æ–¥–∞–∂–∏"],
          ...testData
        ],
        columnNames: ["–¢–æ–≤–∞—Ä", "–ü–æ—Å—Ç–∞–≤—â–∏–∫", "–¶–µ–Ω–∞", "–û–±—ä–µ–º", "–ü—Ä–æ–¥–∞–∂–∏"]
      };

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
      const firstCell = sheetData.columnNames[0];
      const hasHeaders = typeof firstCell === 'string' && firstCell.length > 0 &&
                         typeof firstCell !== 'number' && !(firstCell instanceof Date);

      let columnNames, dataToSend;

      if (hasHeaders) {
        // –ï—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏
        columnNames = sheetData.columnNames;
        dataToSend = sheetData.data.slice(1, 11);  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
        resultDiv.textContent += '\nüìã –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø—Ä–æ–ø—É—Å–∫–∞—é –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É';
      } else {
        // –ù–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        const numColumns = sheetData.data[0].length;
        columnNames = [];
        for (let i = 0; i < numColumns; i++) {
          columnNames.push(`–ö–æ–ª–æ–Ω–∫–∞ ${String.fromCharCode(65 + i)}`);
        }
        dataToSend = sheetData.data.slice(0, 10);  // –ë–µ—Ä—ë–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
        resultDiv.textContent += '\n‚ö†Ô∏è –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ';
      }

      const payload = {
        query: "—É –∫–∞–∫–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂",
        column_names: columnNames,
        sheet_data: dataToSend,
        history: []
      };

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        resultDiv.className = 'result success';
        resultDiv.textContent = `üìä –≠–ú–£–õ–Ø–¶–ò–Ø GOOGLE SHEETS:
–ó–∞–≥–æ–ª–æ–≤–∫–∏: ${hasHeaders ? '–î–ê' : '–ù–ï–¢'}
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–ª–æ–Ω–æ–∫: ${columnNames.join(', ')}
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫: ${dataToSend.length}

‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢:
${result.summary || '–ù–ï–¢'}

–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è: ${result.methodology || '–ù–ï–¢'}

–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:
${result.key_findings ? result.key_findings.join('\n') : '–ù–ï–¢'}

–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:
${JSON.stringify(result, null, 2)}`;
      } catch(error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
      }
    }
  </script>
</body>
</html>