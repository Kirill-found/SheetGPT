"""
–¢–µ—Å—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã —Å –ü–û–õ–ù–´–ú –≤—ã–≤–æ–¥–æ–º generated code
–ü–æ–∫–∞–∂–µ—Ç —á—Ç–æ –∏–º–µ–Ω–Ω–æ AI Code Executor –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç
"""

import requests
import json

# –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã
column_names = ["–ö–æ–ª–æ–Ω–∫–∞ A", "–ö–æ–ª–æ–Ω–∫–∞ B", "–ö–æ–ª–æ–Ω–∫–∞ C", "–ö–æ–ª–æ–Ω–∫–∞ D", "–ö–æ–ª–æ–Ω–∫–∞ E"]

# –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –û–û–û –ö–æ—Å–º–æ—Å (6 —Ç–æ–≤–∞—Ä–æ–≤)
sheet_data = [
    ["–¢–æ–≤–∞—Ä 1", "–û–û–û –í—Ä–µ–º—è", 5000, 2, 10000],
    ["–¢–æ–≤–∞—Ä 2", "–û–û–û –†–∞–¥–æ—Å—Ç—å", 3500, 3, 10500],
    ["–¢–æ–≤–∞—Ä 3", "–û–û–û –ö–æ—Å–º–æ—Å", 4500, 1, 4500],  # –¶–µ–Ω–∞ 4500
    ["–¢–æ–≤–∞—Ä 4", "–û–û–û –ö–æ—Å–º–æ—Å", 5000, 2, 10000],  # –¶–µ–Ω–∞ 5000
    ["–¢–æ–≤–∞—Ä 5", "–û–û–û –ö–æ—Å–º–æ—Å", 4200, 1, 4200],   # –¶–µ–Ω–∞ 4200
    ["–¢–æ–≤–∞—Ä 6", "–û–û–û –ö–æ—Å–º–æ—Å", 3800, 2, 7600],   # –¶–µ–Ω–∞ 3800
    ["–¢–æ–≤–∞—Ä 7", "–û–û–û –ö–æ—Å–º–æ—Å", 4100, 1, 4100],   # –¶–µ–Ω–∞ 4100
    ["–¢–æ–≤–∞—Ä 8", "–û–û–û –ö–æ—Å–º–æ—Å", 3335, 2, 6670],   # –¶–µ–Ω–∞ 3335
    # –ö–æ—Å–º–æ—Å –∏—Ç–æ–≥–æ: 6 —Ç–æ–≤–∞—Ä–æ–≤, —Å—É–º–º–∞ —Ü–µ–Ω = 25935, —Å—Ä–µ–¥–Ω—è—è = 4322.50
    ["–¢–æ–≤–∞—Ä 9", "–û–û–û –í—Ä–µ–º—è", 6000, 1, 6000],
    ["–¢–æ–≤–∞—Ä 10", "–û–û–û –†–∞–¥–æ—Å—Ç—å", 4000, 2, 8000],
]

payload = {
    "query": "–∫–∞–∫–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ —É –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
    "column_names": column_names,
    "sheet_data": sheet_data,
    "history": []
}

print("=" * 80)
print("–¢–ï–°–¢: –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ —É –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞")
print("=" * 80)
print(f"\n–î–∞–Ω–Ω—ã–µ:")
print(f"- –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: {len(sheet_data)}")
print(f"- –û–û–û –ö–æ—Å–º–æ—Å —Ç–æ–≤–∞—Ä–æ–≤: 6")
print(f"- –û–û–û –ö–æ—Å–º–æ—Å —Ü–µ–Ω—ã: 4500, 5000, 4200, 3800, 4100, 3335")
print(f"- –û–û–û –ö–æ—Å–º–æ—Å —Å—É–º–º–∞ —Ü–µ–Ω: 25935")
print(f"- –û–û–û –ö–æ—Å–º–æ—Å —Å—Ä–µ–¥–Ω—è—è (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è): 25935 / 6 = 4322.50 —Ä—É–±\n")

print("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ API...\n")

try:
    response = requests.post(
        "https://sheetgpt-production.up.railway.app/api/v1/formula",
        json=payload,
        timeout=30
    )

    result = response.json()

    print("=" * 80)
    print("–û–¢–í–ï–¢ –û–¢ API:")
    print("=" * 80)
    print(json.dumps(result, indent=2, ensure_ascii=False))
    print("\n")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ generated code
    if "code_generated" in result:
        print("=" * 80)
        print("üêç –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–´–ô PYTHON –ö–û–î:")
        print("=" * 80)
        print(result["code_generated"])
        print("\n")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º summary
    if "summary" in result:
        print("=" * 80)
        print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢ (summary):")
        print("=" * 80)
        print(result["summary"])
        print("\n")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º methodology
    if "methodology" in result:
        print("=" * 80)
        print("üí° –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø:")
        print("=" * 80)
        print(result["methodology"])
        print("\n")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –û–û–û –ö–æ—Å–º–æ—Å
    if "summary" in result and "–ö–æ—Å–º–æ—Å" in result["summary"]:
        import re
        # –ò—â–µ–º —á–∏—Å–ª–æ –ø–æ—Å–ª–µ "–ö–æ—Å–º–æ—Å"
        match = re.search(r'–ö–æ—Å–º–æ—Å[^0-9]+([\d,\.]+)', result["summary"])
        if match:
            calculated = match.group(1).replace(',', '')
            print("=" * 80)
            print("‚úÖ –ü–†–û–í–ï–†–ö–ê:")
            print("=" * 80)
            print(f"–û–∂–∏–¥–∞–ª–æ—Å—å –¥–ª—è –û–û–û –ö–æ—Å–º–æ—Å: 4322.50 —Ä—É–±")
            print(f"–ü–æ–ª—É—á–µ–Ω–æ: {calculated} —Ä—É–±")

            try:
                calc_float = float(calculated)
                expected = 4322.50
                diff = abs(calc_float - expected)

                if diff < 1:
                    print("‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û!")
                else:
                    print(f"‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –†–∞–∑–Ω–∏—Ü–∞: {diff:.2f}")
            except:
                print(f"‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –ù–µ —á–∏—Å–ª–æ: {calculated}")

    print("\n" + "=" * 80)

except Exception as e:
    print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
    import traceback
    traceback.print_exc()
