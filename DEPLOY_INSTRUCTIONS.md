# Инструкция по деплою на Railway

## Текущий статус кода

✅ Код готов к деплою
✅ Коммиты запушены в GitHub: `7b5f6af`, `5c42e3b`
✅ Добавлена поддержка русских функций ИНДЕКС/ПОИСКПОЗ

## Что исправлено

### Проблема
AI генерировал формулы с русскими названиями функций:
```
ИНДЕКС($I:$I;ПОИСКПОЗ(B2:B;$H:$H;0))
```

Постпроцессинг НЕ обрабатывал такие формулы (работал только с английскими INDEX/MATCH), поэтому неправильные ссылки на столбцы не исправлялись.

### Решение
Добавлена поддержка русских функций в постпроцессинг:

**Файл**: `backend/app/services/ai_service.py` (строки 232-345)

**Изменения**:
1. Детекция языка формулы (английский или русский)
2. Два regex паттерна (для INDEX/MATCH и ИНДЕКС/ПОИСКПОЗ)
3. Возврат исправленной формулы на том же языке

**Пример работы**:
- **ДО**: `ИНДЕКС($I:$I;ПОИСКПОЗ(B2:B;$H:$H;0))` → не исправляется
- **ПОСЛЕ**: `ИНДЕКС($I:$I;ПОИСКПОЗ(B2:B;$H:$H;0))` → `ИНДЕКС($H:$H; ПОИСКПОЗ(B2:B; $G:$G; 0))`

## Как задеплоить

### Автоматический деплой (если настроен)
Railway должен автоматически подхватить новый коммит из GitHub и задеплоить.

### Ручной деплой через веб-интерфейс
1. Открой https://railway.app/
2. Войди в свой проект
3. Выбери сервис `backend` (или `sheetgpt-production`)
4. Нажми кнопку **"Deploy"** или **"Redeploy"**
5. Подожди 2-3 минуты пока Railway соберёт и запустит новую версию

### Ручной деплой через CLI (если установлен)
```bash
cd C:/SheetGPT/backend
railway up
```

## Проверка после деплоя

После успешного деплоя запусти тест:
```bash
cd C:/SheetGPT
python test_russian_postprocessing.py
```

Или отправь тестовый запрос:
```bash
curl -X POST "https://sheetgpt-production.up.railway.app/api/v1/formula" \
  -H "Content-Type: application/json" \
  -d @test_russian_formula.json
```

Ожидаемый результат:
- ✅ Формула содержит ИНДЕКС и ПОИСКПОЗ (не INDEX/MATCH)
- ✅ Ищет в столбце G:G (текстовые данные)
- ✅ Возвращает из столбца H:H (числовые данные)
- ✅ НЕ использует столбец I:I (не существует)

## Файлы для тестирования

- `test_russian_formula.json` - тестовые данные
- `test_russian_postprocessing.py` - скрипт для автоматического теста
- `test_new_task.json` - данные из задачи пользователя

## Коммиты

- `7b5f6af` - Add support for Russian function names in INDEX/MATCH postprocessing
- `5c42e3b` - Trigger Railway redeploy - Russian function names support
