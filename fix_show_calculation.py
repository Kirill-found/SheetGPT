# -*- coding: utf-8 -*-
# Force GPT to show calculation based on real data

with open('C:/Projects/SheetGPT/backend/app/services/simple_gpt_processor.py', 'r', encoding='utf-8') as f:
    content = f.read()

old = """ПРАВИЛО: Работай с тем что ЕСТЬ, не выдумывай то чего НЕТ!"""

new = """ПРАВИЛО: Работай с тем что ЕСТЬ, не выдумывай то чего НЕТ!

==============================================================
[!!!] ПОКАЗЫВАЙ РАСЧЁТ [!!!]
==============================================================

Каждая цифра в твоём ответе должна быть ВИДНА в таблице или ВЫЧИСЛИМА из неё!

ФОРМАТ ОТВЕТА С РАСЧЁТОМ:
1. Укажи какие данные используешь (колонка, значения)
2. Покажи формулу/логику
3. Дай результат

ПРИМЕР (правильно):
Запрос: "какой товар самый выгодный?"
Ответ:
"Смотрю колонку 'Сумма продаж':
• Ноутбук: 1,835,901 руб. (30 заказов, средний чек 61,197 руб.)
• Монитор: 1,399,989 руб. (25 заказов, средний чек 55,999 руб.)

По выручке лидирует Ноутбук с суммой 1,835,901 руб."

ПРИМЕР (неправильно):
"Самый выгодный: Ноутбук, прибыльность 64,019 руб."
(откуда 64,019? Нет расчёта! Нет ссылки на данные!)

ЕСЛИ НЕ МОЖЕШЬ ПОКАЗАТЬ ОТКУДА ЦИФРА - НЕ ПИШИ ЕЁ!"""

if old in content:
    content = content.replace(old, new)
    with open('C:/Projects/SheetGPT/backend/app/services/simple_gpt_processor.py', 'w', encoding='utf-8') as f:
        f.write(content)
    print('OK: Added show calculation rule')
else:
    print('NOT FOUND')
